@page "/quiz/result/{id:guid}"
@model Educational_Platform_Front_End.Pages.Quizzes.QuizResultModel

@{ 
    ViewData["Title"] = "Quiz Result";
    var scorePercentage = Model.QuizAttempt != null && Model.QuizAttempt.Questions.Any() 
        ? (double)Model.QuizAttempt.TotalScore / Model.QuizAttempt.Questions.Sum(q => q.Score) * 100 
        : 0;
    var isPassed = scorePercentage >= 60;
}

<div class="container py-5">
    @if (Model.QuizAttempt != null)
    {
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <div class="card border-0 shadow-sm rounded-xl overflow-hidden mb-4">
                    <div class="card-body p-5">
                        <div class="mb-4">
                            @if (isPassed)
                            {
                                <div class="bg-success-light d-inline-flex p-4 rounded-circle mb-3">
                                    <i class="lucide-party-popper text-success" style="width: 48px; height: 48px;"></i>
                                </div>
                                <h1 class="display-4 font-weight-bold text-success">Congratulations!</h1>
                                <p class="lead text-muted">You have successfully passed the assessment.</p>
                            }
                            else
                            {
                                <div class="bg-warning-light d-inline-flex p-4 rounded-circle mb-3">
                                    <i class="lucide-alert-circle text-warning" style="width: 48px; height: 48px;"></i>
                                </div>
                                <h1 class="display-4 font-weight-bold text-warning">Keep Learning!</h1>
                                <p class="lead text-muted">You've completed the assessment. Review the material and try again to improve your score.</p>
                            }
                        </div>

                        <div class="row justify-content-center mb-5">
                            <div class="col-md-4">
                                <div class="p-3 border rounded-lg bg-light">
                                    <small class="text-uppercase text-muted tracking-wider font-weight-bold">Your Score</small>
                                    <div class="h2 font-weight-bold mb-0">@Model.QuizAttempt.TotalScore</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="p-3 border rounded-lg bg-light">
                                    <small class="text-uppercase text-muted tracking-wider font-weight-bold">Percentage</small>
                                    <div class="h2 font-weight-bold mb-0">@scorePercentage.ToString("F0")%</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="p-3 border rounded-lg bg-light">
                                    <small class="text-uppercase text-muted tracking-wider font-weight-bold">Time Taken</small>
                                    <div class="h2 font-weight-bold mb-0">@Model.QuizAttempt.TotalTimeMinutes mins</div>
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-3 d-sm-flex justify-content-sm-center">
                            <a asp-page="/Dashboard/Index" class="btn btn-primary px-5 py-3 rounded-pill font-weight-bold">
                                Go to Dashboard
                            </a>
                            <a asp-page="./AvailableQuizzes" class="btn btn-outline-secondary px-5 py-3 rounded-pill font-weight-bold">
                                Back to Quizzes
                            </a>
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm rounded-xl">
                    <div class="card-header bg-white border-0 pt-4 px-4">
                        <h3 class="h5 font-weight-bold text-dark mb-0 text-left">Summary Details</h3>
                    </div>
                    <div class="card-body p-4">
                        <ul class="list-group list-group-flush text-left">
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span class="text-muted">Assessment Title</span>
                                <span class="font-weight-bold">@Model.QuizAttempt.QuizTitle</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span class="text-muted">Completed On</span>
                                <span class="font-weight-bold">@(Model.QuizAttempt.SubmittedAt?.ToString("MMM dd, yyyy HH:mm") ?? "N/A")</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span class="text-muted">Total Questions</span>
                                <span class="font-weight-bold">@Model.QuizAttempt.Questions.Count</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading result...</span>
            </div>
        </div>
    }

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger alert-dismissible fade show rounded-lg border-0 shadow-sm mt-4" role="alert">
            <i class="lucide-alert-circle mr-2"></i> @Model.ErrorMessage
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }
</div>

<style>
    .rounded-xl { border-radius: 1rem !important; }
    .bg-success-light { background-color: rgba(16, 185, 129, 0.1); }
    .bg-warning-light { background-color: rgba(245, 158, 11, 0.1); }
    .btn-primary { background-color: #4f46e5; border-color: #4f46e5; }
    .btn-primary:hover { background-color: #4338ca; border-color: #4338ca; }
</style>
