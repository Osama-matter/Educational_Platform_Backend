@page
@model Educational_Platform_Front_End.Pages.Admin.Lessons.IndexModel
@{
    ViewData["Title"] = "Lesson Management";
}

@section Styles {
    <link rel="stylesheet" href="~/css/enterprise-design-system.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/admin-dashboard.css" asp-append-version="true" />
}

<div class="admin-layout" id="adminLayout">
    <aside class="admin-layout__sidebar">
        <nav class="admin-sidebar">
            <div class="admin-sidebar__brand">
                <div class="admin-sidebar__logo">E</div>
                <span class="admin-sidebar__brand-text">EduAdmin</span>
            </div>

            <div class="admin-sidebar__nav">
                <div class="admin-sidebar__section">
                    <div class="admin-sidebar__section-title">Overview</div>
                    <a asp-page="/Dashboard/AdminDashboard" class="admin-sidebar__link">
                        <i data-lucide="layout-dashboard" class="admin-sidebar__link-icon"></i>
                        <span class="admin-sidebar__link-text">Dashboard</span>
                    </a>
                </div>

                <div class="admin-sidebar__section">
                    <div class="admin-sidebar__section-title">Content</div>
                    <a asp-page="/Dashboard/CourseManagement" class="admin-sidebar__link">
                        <i data-lucide="book-open" class="admin-sidebar__link-icon"></i>
                        <span class="admin-sidebar__link-text">Courses</span>
                    </a>
                    <a asp-page="/Admin/Lessons/Index" class="admin-sidebar__link admin-sidebar__link--active">
                        <i data-lucide="video" class="admin-sidebar__link-icon"></i>
                        <span class="admin-sidebar__link-text">Lessons</span>
                    </a>
                </div>

                <div class="admin-sidebar__section">
                    <div class="admin-sidebar__section-title">Users</div>
                    <a asp-page="/Dashboard/Index" class="admin-sidebar__link">
                        <i data-lucide="users" class="admin-sidebar__link-icon"></i>
                        <span class="admin-sidebar__link-text">Enrollments</span>
                    </a>
                </div>
            </div>
        </nav>
    </aside>

    <header class="admin-layout__header">
        <div class="admin-header">
            <div class="admin-header__left">
                <button class="admin-header__toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                    <i data-lucide="menu" style="width: 20px; height: 20px;"></i>
                </button>
                <div>
                    <h1 class="heading-4" style="margin-bottom: var(--space-1);">Lesson Management</h1>
                    <p class="text-small text-muted">Control lesson publishing, structure, and sequencing.</p>
                </div>
            </div>

            <div class="admin-header__right">
                <a asp-page="/Admin/Lessons/Create" class="btn btn--primary btn--sm">
                    <i data-lucide="plus" class="btn__icon"></i>
                    New Lesson
                </a>
            </div>
        </div>
    </header>

    <main class="admin-layout__main">
        <div class="data-table-container">
            <div class="data-table__header">
                <div>
                    <h2 class="data-table__title">Lessons</h2>
                    <p class="text-small text-muted">@Model.Lessons.Count lesson(s) across @Model.Courses.Count course(s).</p>
                </div>
            </div>

            <table class="data-table" role="table">
                <thead class="data-table__head">
                    <tr class="data-table__row">
                        <th class="data-table__th">Lesson</th>
                        <th class="data-table__th">Course</th>
                        <th class="data-table__th">Order</th>
                        <th class="data-table__th">Duration</th>
                        <th class="data-table__th">Status</th>
                        <th class="data-table__th">Updated</th>
                        <th class="data-table__th data-table__td--actions">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (!Model.Lessons.Any())
                    {
                        <tr class="data-table__row">
                            <td class="data-table__td" colspan="7">
                                <div class="data-table__empty">
                                    <i data-lucide="video" class="data-table__empty-icon"></i>
                                    <div class="data-table__empty-title">No lessons created yet</div>
                                    <p class="data-table__empty-description">Start organizing your curriculum by creating the first lesson.</p>
                                    <a asp-page="/Admin/Lessons/Create" class="btn btn--primary btn--sm">Create Lesson</a>
                                </div>
                            </td>
                        </tr>
                    }
                    else
                    {
                        @foreach (var lesson in Model.Lessons)
                        {
                            var courseName = Model.CourseLookup.TryGetValue(lesson.CourseId, out var title)
                                ? title
                                : "Unassigned";
                            var updatedOn = lesson.UpdatedAt ?? lesson.CreatedAt;
                            <tr class="data-table__row">
                                <td class="data-table__td">
                                    <div class="data-table__title">@lesson.Title</div>
                                    <div class="text-small text-muted">@lesson.Content?.Substring(0, Math.Min(lesson.Content.Length, 80))</div>
                                </td>
                                <td class="data-table__td">@courseName</td>
                                <td class="data-table__td">@lesson.OrderIndex</td>
                                <td class="data-table__td">@(lesson.DurationMinutes?.ToString() ?? "â€”") min</td>
                                <td class="data-table__td">
                                    <span class="badge badge--@(lesson.Status == "Published" ? "success" : "warning")">@lesson.Status</span>
                                </td>
                                <td class="data-table__td">@updatedOn.ToString("MMM dd, yyyy")</td>
                                <td class="data-table__td data-table__td--actions">
                                    <a asp-page="/Lessons/Details" asp-route-id="@lesson.Id" class="btn btn--ghost btn--sm">View</a>
                                    <a asp-page="/Admin/Lessons/Edit" asp-route-id="@lesson.Id" class="btn btn--secondary btn--sm">Edit</a>
                                    <form method="post" asp-page-handler="Delete" asp-route-id="@lesson.Id" class="inline-form">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn--danger btn--sm" onclick="return confirm('Delete this lesson? This action cannot be undone.');">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </main>
</div>

@section Scripts {
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        lucide.createIcons();
    </script>
}
